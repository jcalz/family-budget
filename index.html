<html>
  <head>
    <title>Tough Choices: Balancing a Budget in Somerville on $36K/Year</title>
    <meta name="description" content="An experiment you can try on your own or with other members of your household.">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script
      src="https://code.jquery.com/jquery-3.1.1.js"
      integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="
      crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <style>
      tr.income-row td.negative,
      tr.expense-row td.diff-amount.positive,
      tr.total-row td.diff-amount.negative,
      tr.total-row td.final-amount.negative
      {
      color: red;
      }
      th {
      background-color: #f2f2f2;
      }
      .btn-space {
      padding-left: 0;
      padding-right: 5px;
      }
    </style>
  </head>
  <body>
    <div class = "container-fluid">
      <h1>Tough Choices<br><small>Balancing a Budget in Somerville on $36K/Year</small></h1>
      <p>Here is an experiment you can try on your own or with other members of your household. Then, please share your ideas on what we can do to help families &mdash; as a City government, school district, and community of residents. The examples below are simplified but realistic for the income and expenses of a family of four in Somerville. Imagine you are in their shoes, and try to balance their monthly budget by making some tough choices.</p>
      <div class = "row">
        <div class = "col-md-6">
          <h3>Monthly family budget</h3>
          <div id="lineItemData" hidden="hidden">
            <div data-title="income" data-initial="3000">
              <p>About 37% of households make less than $50,000. And 1,920 households (with about 2,304 children) make less than $23,550/year) Among students enrolled in the Somerville Public Schools, 66% of students qualify for free and reduced lunch, which requires that a family of four makes $50,000 or less.</p>
              <p>Source: <a target="_blank" href="http://profiles.doe.mass.edu/students/classsizebygenderpopulation.aspx?orgcode=02740000&fycode=2014 ">Census ACS 2015 and 2013-2014 DESE.</a></p>
            </div>
            <div data-title="rent" data-initial="-2100">
              <p>The median rent in Somerville is $2,384 for apartments of all sizes (source: Sustainable Neighborhoods Working Group Recommendations Report) A look at Craiglist shows the least expensive three-bedroom currently listed is $2,100/month &mdash; and the competition for those places is fierce. Often landlords prefer to rent to people without children and require a high credit score. 
              </p>
              <p>Source: <a target="_blank" href="http://www.somervillema.gov/snwg">Sustainable Neighborhoods Working Group</a></p>
            </div>
            <div data-title="childcare" data-initial="-1000">
              <p>The average cost of childcare in the Boston area is $17,062 for infants and $12,781 for a four-year-old, according to a report from the Economic Policy Institute. The YMCA (at $55/day) and the Somerville High School (at $45/day) are among Somerville's more affordable options.</p>
              <p>Source: <a target="_blank" href="http://www.epi.org/child-care-costs-in-the-united-states/#/MA">Economic Policy Institute</a></p>
            </div>
            <div data-title="food" data-initial="-800">
              <p>The average cost of food</p>
            </div>
            <div data-title="transportation" data-initial="-180">
              <p>The average cost of care ownership is $2,168 for insurance, repair, and gas, or $180/month. The cost of an MBTA pass for bus and subway is $84.50/month, while the Zone 8 (for Fitchburg) pass is $363.00/month.</p>
              <p>Source: <a target="_blank" href="http://www.bankrate.com/finance/auto/car-ownership-costs-by-state.aspx">Bankrate</a>
            </div>
            <div data-title="recreation" data-initial="-300">
              <p>Your recreation budget pays for entertainment, vacations, and programs for your children.</p>
            </div>
          </div>
          <table class="table table-condensed table-bordered" id="budgetTable">
            <thead>
              <th class="col-md-3">Line Item</th>
              <th class="col-md-1 text-right">Intial</th>
              <th class="col-md-1 text-right">Change</th>
              <th class="col-md-1 text-right">Final</th>
            </thead>
            <tbody id="budgetBody">
            </tbody>
          </table>
        </div>
        <form class="form col-md-6" id="choices" onsubmit="return false;">
          <h3>Options</h3>
          <div class="checkbox">
            <label><input type="checkbox" id="fitchburg">
            <span>Move to Fitchburg</span>
            <span class="help-block">You can save money on rent by moving out of Somerville, but your additional three hours of daily commuting means you need more childcare. You may also need to spend more on transportation, like gas or an MBTA pass (not included in model) </span></label>
          </div>
          <div class="checkbox">
            <label><input type="checkbox" id="mbta">
            <span>Use public transportation</span>
            <span class="help-block">If you get rid of your car and use an MBTA bus pass instead, you will save money on transportation.  Unfortunately, the buses may not always run when you need to go to work.</span></label>
          </div>
          <div class="checkbox">
            <label>
            <input type="checkbox" id="friend">
            <span>Move in with a friend</span>
            <span class="help-block">Cut your monthly rent in half by sharing a 1,000 square foot apartment with another family.  Can your family make this work?</span></label>  
          </div>
          <div class="checkbox">
            <label>
            <input type="checkbox" id="secondJob">
            <span>Get a second job</span>
            <span class="help-block">Work an additional twenty hours a week.  Your income will increase, but you will need more childcare.</span></label>
          </div>
          <div class="checkbox">
            <label><input type="checkbox" id="cans">
            <span>Collect cans in your spare time</span>
            <span class="help-block">Spend an hour each day collecting recyclable cans.  You will need more childcare to cover the time when you are unavailable. Cans can be redeemed at $.05/can. </span></label>
          </div>
          <div class="checkbox">  
            <label><input type="checkbox" id="noRecreation">
            <span>Forgo all recreation</span>
            <span class="help-block">Your recreation budget pays for entertainment, vacations, and programs for your children.  You may choose to go without.</span></label>
          </div>
        </form>
      </div>
      <div class="row">
        <div class="col-md-12">
          <h3>Sharing</h3>
          <form class="form" id="sharing" onsubmit="return false;">
            <div class="form-group">
              <label for="comments">
                <span>Share your thoughts</span>
                <p class="help-block">What do you think can be done to address this issue?</p>
              </label>
              <textarea class="form-control" id="comments"></textarea>
            </div>
            <a id="facebook-button" role="button" class="btn btn-default btn-lg" href="" target="_blank">
            Share on Facebook
            </a>
            <a id="email-button" role="button" class="btn btn-default btn-lg" href="" target="_blank">
            Submit via Email
            </a>
          </form>
        </div>
      </div>
    </div>
  </body>
  <script>
    "use strict";
    
    var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };
    
    function titleCase(str) {
      return str.toLowerCase().split(" ").map(function (v) {
        return v.charAt(0).toUpperCase() + v.slice(1);
      }).join(" ");
    }
    	
    
    function money(v) {
      var r = [];        
      r.push(v<0 ? "-" : "");
      r.push("$");
      var s = Math.abs(v).toFixed(0); 
      var commas = Math.floor((s.length-1)/3);
      var firstComma = s.length - (3*commas);
      r.push(s.substring(0,firstComma));
      for (var p=firstComma; p<s.length; p+=3) {
          r.push(",");
          r.push(s.substring(p,p+3));
      }
      return r.join('');
    }
    
    function objectMerge(into, from) {
      Object.keys(from).forEach(function (k) {
        if (_typeof(from[k]) === "object") {
          if (!(k in into)) into[k] = {};
          if (_typeof(into[k]) !== "object") into[k] = {
            value: into[k]
          };
          objectMerge(into[k], from[k]);
        } else {
          into[k] = from[k];
        }
      });
    }
    
    
    
    var initialLineItems = {};
    var helpButton = {};
    
    
    function hidePopovers() {
      showPopover(false);
    }
    function showPopover(el, toggle) {
    $('a.helpButton').not(el).popover('hide');
    if (!el) return;
    var shown = $(el).data()['bs.popover'].tip().hasClass('in');
    
    if (!shown) {
    $(el).popover('show');
    } else if (toggle) {
    $(el).popover('hide');
    }
    }
    
    $('#lineItemData>div').each(function(i,e){
        var key = $(e).data('title');
    initialLineItems[key]=Number($(e).data('initial'));
    
    var button = $('<a data-info="'+key+'" tabindex="0" role="button" class="helpButton btn btn-link btn-space btn-lg" onclick="showPopover(this, true)" onmouseenter="showPopover(this)">'+
     '<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>'+
     '</a>');
    
    button.popover({container: 'body', html:true, content: $(e).html(),
       title: titleCase(key)+'<button type="button" class="close" onclick="hidePopovers()">&times;</button>', 
    trigger: 'manual'});
     helpButton[key]=button;
    
    
    });
    
    
    
    function getBudget(options) {
      var o = {
        fitchburg: false,
        mbta: false,
        friend: false,
        secondJob: false,
        cans: false,
        cansHours: 30,
        noRecreation: false,
        initialLineItems: initialLineItems
      };
      objectMerge(o, options || {});
    
      var budget = Object.assign({}, o.initialLineItems);
      budget.income = o.initialLineItems.income + (o.secondJob ? 900 : 0) + (o.cans ? o.cansHours * 3 : 0);
      budget.rent = (o.fitchburg ? -1500 : o.initialLineItems.rent) * (o.friend ? 0.5 : 1);
      budget.childcare = o.initialLineItems.childcare - (o.fitchburg ? 600 : 0) - (o.secondJob ? 800 : 0) - (o.cans ? o.cansHours * 10 : 0);
      budget.food = o.initialLineItems.food;
      budget.transportation = o.mbta ? -96 : o.initialLineItems.transportation;
      budget.recreation = o.noRecreation ? 0 : o.initialLineItems.recreation;
    
      return budget;
    };
    
    function displayBudget(budget, initialBudget) {
      var rows = [];
    
      function headerRow(title) {
        var ret = $('<tr>');
        ret.append($('<th>').text(title));
        ret.append($('<th>'));
        ret.append($('<th>'));
        ret.append($('<th>'));
        return ret;
      }
    
      function lineItemRow(title, amount, initialAmount, button) {
        var diff = amount - initialAmount;
        var ret = $('<tr>');	
        var titleCell = $('<td>');
        if (button) titleCell.append(button);
        titleCell.append($('<span>').text(titleCase(title)));          
        ret.append(titleCell);
        ret.append($('<td>').text(money(initialAmount)).addClass('init-amount text-right').toggleClass('negative',initialAmount<0).toggleClass('positive',initialAmount>0));    
        ret.append($('<td>').text((diff>=0 ? '+' : '')+money(diff)).addClass('diff-amount text-right').toggleClass('negative',diff<0).toggleClass('positive',diff>0));    
        ret.append($('<td>').text(money(amount)).addClass('final-amount text-right').toggleClass('negative',amount<0).toggleClass('positive',amount>0));   
        return ret;
      }
      rows.push(headerRow('Income'));
      var ks = Object.keys(initialBudget);
      ks.forEach(function (k) {
        if (initialBudget[k] > 0) rows.push(lineItemRow(k, budget[k], initialBudget[k], helpButton[k]).addClass('income-row'));
      });
      rows.push(headerRow('Expenses'));
      ks.forEach(function (k) {
        if (initialBudget[k] <= 0) rows.push(lineItemRow(k, -budget[k], -initialBudget[k], helpButton[k]).addClass('expense-row'));
      });
      var net = ks.reduce(function (a, k) {
        return a + budget[k];
      }, 0);
      var initialNet = ks.reduce(function (a, k) {
        return a + initialBudget[k];
      }, 0);
      rows.push(headerRow('Total'));
      rows.push(lineItemRow('Savings', net, initialNet).addClass('total-row'));
    
      $('#budgetBody').empty().append(rows);
    }
    
    function updateDisplay() {
      var o = {};
      $('#choices input[type=checkbox]').each(function (i, e) {
        o[$(e).prop('id')] = $(e).prop('checked');
      });
      displayBudget(getBudget(o), getBudget());
    }
        
    function facebookShareUrl(title, description, quote) {
                var url = 'https://www.facebook.com/sharer/sharer.php?u=' +
              encodeURIComponent('https://jcalz.github.io/family-budget')+
              //'&picture=' + encodeURIComponent(previewImgUrl) +
              '&title=' + encodeURIComponent(title) +
              '&description=' + encodeURIComponent(description) +
              '&quote=' + encodeURIComponent(quote)
                return url;
    
    }
    
    function emailUrl(title, description, quote) {
        var url = 'mailto:contact@stephanieforsomerville.com?subject='+
          encodeURIComponent('Feedback about '+title)+
          '&body='+encodeURIComponent('Feedback about '+title+' at https://jcalz.github.io/family-budget\n\n'+quote);
        return url;
    }
    
    function updateSharingButtons() {
        var title=document.title;
        var description=$('meta[name=description]').attr('content');
        var quote=$('#comments').val();
        $('#facebook-button').attr('href',facebookShareUrl(title,description,quote));
       $('#email-button').attr('href',emailUrl(document.title,description,quote));  
    }
    
    $(function () {
      updateDisplay();
      $('#choices').change(updateDisplay);
      updateSharingButtons();
      $('#comments').change(updateSharingButtons);
    });
      
  </script>
</html>
